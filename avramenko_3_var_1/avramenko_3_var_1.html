<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2025-03-16 Sun 23:57 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ООП: розробка сховища даних</title>
<meta name="author" content="Авраменко Ігор Андрійович 201-Б" />
<meta name="generator" content="Org Mode" />
<style type="text/css">
  #content { max-width: 60em; margin: auto; }
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #e6e6e6;
    border-radius: 3px;
    background-color: #f2f2f2;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: auto;
  }
  pre.src:before {
    display: none;
    position: absolute;
    top: -8px;
    right: 12px;
    padding: 3px;
    color: #555;
    background-color: #f2f2f299;
  }
  pre.src:hover:before { display: inline; margin-top: 14px;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-authinfo::before { content: 'Authinfo'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { }
</style>
</head>
<body>
<div id="content" class="content">
<h1 class="title">ООП: розробка сховища даних</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org8bed96c">1. 6.2 Дослідження сховища в інтерактивному сеансі.</a></li>
<li><a href="#org123f3a1">2. 6.2 <b><b>!!!ВІДХОДЖУ ВІД ПРИЛКЛАДУ ЛАБОРАТОНОЇ РОБОТИ!!!</b></b></a></li>
<li><a href="#org3e3557f">3. 6.2 Продовження</a></li>
<li><a href="#org2911998">4. 6.3 Оновлення об'єктів в сховищі</a></li>
</ul>
</div>
</div>
<div id="outline-container-org8bed96c" class="outline-2">
<h2 id="org8bed96c"><span class="section-number-2">1.</span> 6.2 Дослідження сховища в інтерактивному сеансі.</h2>
<div class="outline-text-2" id="text-1">
<p>
Маємо у поточному робочому каталозі один або більше файлів, імена яких
розпочинаються з <code>«persondb»</code>. Реально створювані файли можуть відрізнятися в
залежності від платформи, функція <code>shelve.open()</code> створює файли в поточному
робочому каталозі, якщо вказане ім'я файлу не містить повний шлях. Але незалежно
від того, де зберігаються ці файли, вони забезпечують доступ по ключу до подання
об'єктів, створених за допомогою модуля <code>pickle</code>. Не видаляйте ці файли – вони є
базою даних, яку доведеться копіювати або переміщувати, коли ви будете
створювати резервні копії вашого сховища або переносити його. Можна заглянути
всередину файлів сховищ за допомогою файлового менеджера (наприклад <code>Dolphin</code> на
<code>GNU/Linux</code>) або за допомогою інтерактивної оболонки <code>Python</code>, проте ці файли
мають двійковий формат і їх вміст не має великого сенсу поза модуль <code>shelve</code>.
Наша БД зберігається в трьох файлах (модуль <code>bsddb</code> є стороннім доповненням, яке
поширюють з відкритими вихідними текстами):
</p>

<div class="org-src-container">
<pre class="src src-python"><span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1052;&#1086;&#1076;&#1091;&#1083;&#1100;, &#1103;&#1082;&#1080;&#1081; &#1076;&#1086;&#1079;&#1074;&#1086;&#1083;&#1103;&#1108; &#1086;&#1090;&#1088;&#1080;&#1084;&#1072;&#1090;&#1080; &#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1092;&#1072;&#1081;&#1083;&#1110;&#1074; &#1091; &#1082;&#1072;&#1090;&#1072;&#1083;&#1086;&#1079;&#1110;:</span>
<span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1087;&#1077;&#1088;&#1077;&#1074;&#1110;&#1088;&#1082;&#1072; &#1085;&#1072;&#1103;&#1074;&#1085;&#1086;&#1089;&#1090;&#1110; &#1092;&#1072;&#1081;&#1083;&#1110;&#1074;</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">import</span> glob
&gt;&gt;&gt; glob.glob<span style="color: #707183;">(</span>&#8215;person*&#8216;<span style="color: #707183;">)</span>
<span style="color: #707183;">[</span>&#8215;person.py&#8216;,&#8215;person.pyc&#8216;,&#8215;persondb.bak&#8216;,&#8215;persondb.dat&#8216;,&#8215;persondb.<span style="color: #8b0000; font-weight: bold;">dir</span>&#8216;<span style="color: #707183;">]</span>
<span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1058;&#1080;&#1087; &#1092;&#1072;&#1081;&#1083;&#1091;: &#1090;&#1077;&#1082;&#1089;&#1090;&#1086;&#1074;&#1080;&#1081; &#8211; &#1076;&#1083;&#1103; &#1088;&#1103;&#1076;&#1082;&#1110;&#1074;, &#1073;&#1110;&#1085;&#1072;&#1088;&#1085;&#1080;&#1081; &#8211; &#1076;&#1083;&#1103; &#1073;&#1072;&#1081;&#1090;&#1110;&#1074;</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span><span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #7388d6;">(</span>&#8215;persondb.<span style="color: #8b0000; font-weight: bold;">dir</span>&#8216;<span style="color: #7388d6;">)</span>.read<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
&#8215;Tom Jones&#8216;, <span style="color: #707183;">(</span><span style="color: #008b8b;">1024</span>, <span style="color: #008b8b;">91</span><span style="color: #707183;">)</span>
...&#1095;&#1072;&#1089;&#1090;&#1080;&#1085;&#1091; &#1088;&#1103;&#1076;&#1082;&#1110;&#1074; &#1086;&#1087;&#1091;&#1097;&#1077;&#1085;&#1086;...
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span><span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #7388d6;">(</span>&#8215;persondb.dat&#8216;, &#8215;rb&#8216;<span style="color: #7388d6;">)</span>.read<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span>
b&#8216;\x80\x03cperson\nPerson\nq\x00<span style="color: #88090B;">)</span>\x81q\x01<span style="color: #88090B;">}</span>q\x02<span style="color: #88090B;">(</span>X\x03\x00\x00\x00
payq\x03K...
...&#1095;&#1072;&#1089;&#1090;&#1080;&#1085;&#1091; &#1088;&#1103;&#1076;&#1082;&#1110;&#1074; &#1086;&#1087;&#1091;&#1097;&#1077;&#1085;&#1086;...
</pre>
</div>
</div>
</div>
<div id="outline-container-org123f3a1" class="outline-2">
<h2 id="org123f3a1"><span class="section-number-2">2.</span> 6.2 <b><b>!!!ВІДХОДЖУ ВІД ПРИЛКЛАДУ ЛАБОРАТОНОЇ РОБОТИ!!!</b></b></h2>
<div class="outline-text-2" id="text-2">
<p>
При запуску запропонованого коду отримую інший результат.
</p>
<div class="org-src-container">
<pre class="src src-python">&#10095; python3
Python <span style="color: #008b8b;">3</span>.<span style="color: #008b8b;">13</span>.<span style="color: #008b8b;">2</span> <span style="color: #707183;">(</span>main, Feb  <span style="color: #008b8b;">5</span> <span style="color: #008b8b;">2025</span>, <span style="color: #008b8b;">08</span>:<span style="color: #008b8b;">05</span>:<span style="color: #008b8b;">21</span><span style="color: #707183;">)</span> <span style="color: #707183;">[</span>GCC <span style="color: #008b8b;">14</span>.<span style="color: #008b8b;">2</span>.<span style="color: #008b8b;">1</span> <span style="color: #008b8b;">20250128</span><span style="color: #707183;">]</span> on linux
Type <span style="color: #8b7500;">"help"</span>, <span style="color: #8b7500;">"copyright"</span>, <span style="color: #8b7500;">"credits"</span> <span style="color: #8b0000; font-weight: bold;">or</span> <span style="color: #8b7500;">"license"</span> <span style="color: #8b0000; font-weight: bold;">for</span> more information.
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">import</span> glob
&gt;&gt;&gt; glob.glob<span style="color: #707183;">(</span><span style="color: #8b7500;">'person*'</span><span style="color: #707183;">)</span>
<span style="color: #707183;">[</span><span style="color: #8b7500;">'persondb-wal'</span>, <span style="color: #8b7500;">'persondb-shm'</span>, <span style="color: #8b7500;">'persondb'</span>, <span style="color: #8b7500;">'person.py'</span><span style="color: #707183;">]</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span><span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #7388d6;">(</span><span style="color: #8b7500;">'persondb.dir'</span><span style="color: #7388d6;">)</span>.read<span style="color: #7388d6;">()</span>
... <span style="color: #707183;">)</span>
Traceback <span style="color: #707183;">(</span>most recent call last<span style="color: #707183;">)</span>:
  File <span style="color: #8b7500;">"&lt;python-input-2&gt;"</span>, line <span style="color: #008b8b;">1</span>, <span style="color: #8b0000; font-weight: bold;">in</span> &lt;module&gt;
    <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span><span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #7388d6;">(</span><span style="color: #8b7500;">'persondb.dir'</span><span style="color: #7388d6;">)</span>.read<span style="color: #7388d6;">()</span>
          ~~~~^^^^^^^^^^^^^^^^
<span style="color: #8b0000;">FileNotFoundError</span>: <span style="color: #7388d6;">[</span>Errno <span style="color: #008b8b;">2</span><span style="color: #7388d6;">]</span> No such <span style="color: #8b0000; font-weight: bold;">file</span> <span style="color: #8b0000; font-weight: bold;">or</span> directory: <span style="color: #8b7500;">'persondb.dir'</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #7388d6;">(</span><span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #909183;">(</span><span style="color: #8b7500;">'persondb'</span><span style="color: #909183;">)</span>.read<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>
Traceback <span style="color: #7388d6;">(</span>most recent call last<span style="color: #7388d6;">)</span>:
  File <span style="color: #8b7500;">"&lt;python-input-3&gt;"</span>, line <span style="color: #008b8b;">1</span>, <span style="color: #8b0000; font-weight: bold;">in</span> &lt;module&gt;
    <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #7388d6;">(</span><span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #909183;">(</span><span style="color: #8b7500;">'persondb'</span><span style="color: #909183;">)</span>.read<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span>
          ~~~~~~~~~~~~~~~~~~~~~^^
  File <span style="color: #8b7500;">"&lt;frozen codecs&gt;"</span>, line <span style="color: #008b8b;">325</span>, <span style="color: #8b0000; font-weight: bold;">in</span> decode
<span style="color: #8b0000;">UnicodeDecodeError</span>: <span style="color: #8b7500;">'utf-8'</span> codec can<span style="color: #8b7500;">'t decode byte 0x86 in position 98: invalid start byte</span>
<span style="color: #8b7500;">&gt;&gt;&gt; print(open('</span>persondb-shm<span style="color: #8b7500;">').read())</span>
<span style="color: #8b7500;">Traceback (most recent call last):</span>
<span style="color: #8b7500;">  File "&lt;python-input-4&gt;", line 1, in &lt;module&gt;</span>
<span style="color: #8b7500;">    print(open('</span>persondb-shm<span style="color: #8b7500;">').read())</span>
<span style="color: #8b7500;">          ~~~~~~~~~~~~~~~~~~~~~~~~~^^</span>
<span style="color: #8b7500;">  File "&lt;frozen codecs&gt;", line 325, in decode</span>
<span style="color: #8b7500;">UnicodeDecodeError: '</span>utf-<span style="color: #008b8b;">8</span><span style="color: #8b7500;">' codec can'</span>t decode byte <span style="color: #008b8b;">0xe2</span> <span style="color: #8b0000; font-weight: bold;">in</span> position <span style="color: #008b8b;">1</span>: invalid continuation byte
</pre>
</div>

<p>
<b><b>ЧИМ ЦЕ ВИКЛИКАНО?</b></b>
Різниця у файлах, що створюються, викликана тим, що на <code>Windows</code> <code>shelve</code>
використовує <code>dumbdbm</code> або <code>dbm</code> залежно від доступності, тоді як на <code>Linux</code> він
зазвичай використовує <code>dbm.gnu</code> або <code>dbm.ndbm</code>. У моєму випадку <code>shelve</code> створило
один файл <code>persondb</code> і додаткові <code>persondb-wal</code> та <code>persondb-shm</code>, що свідчить про
використання <code>SQLite</code> як бекенду.
</p>

<ul class="org-ul">
<li>Використання <code>SQLite</code> як бекенду підтверджує відображення типу у файловому менеджері <code>Dolphin</code>:
<img src="sqlite.png" alt="sqlite.png" /></li>
</ul>


<p>
Щоб перевірити вміст бази даних, замість відкриття <code>.dir</code> чи <code>.dat</code> я отримую
дані через shelve:
</p>
<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">import</span> shelve
&gt;&gt;&gt; <span style="color: #a0522d;">db</span> = shelve.<span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #707183;">(</span><span style="color: #8b7500;">"persondb"</span><span style="color: #707183;">)</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">for</span> key <span style="color: #8b0000; font-weight: bold;">in</span> db:
...     <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span>key,<span style="color: #8b7500;">"=&gt;"</span>,db<span style="color: #7388d6;">[</span>key<span style="color: #7388d6;">]</span><span style="color: #707183;">)</span>
... db.close<span style="color: #707183;">()</span>
... 
Bob <span style="color: #a0522d;">Smith</span> =&gt; Bob Smith, <span style="color: #008b8b;">None</span>, <span style="color: #008b8b;">0</span>.<span style="color: #008b8b;">0</span>
Sue <span style="color: #a0522d;">Jones</span> =&gt; Sue Jones, dev, <span style="color: #008b8b;">100000</span>.<span style="color: #008b8b;">0</span>
Tom <span style="color: #a0522d;">Jones</span> =&gt; Tom Jones, mgr, <span style="color: #008b8b;">50000</span>.<span style="color: #008b8b;">0</span>
&gt;&gt;&gt; 
</pre>
</div>
<p>
Цей метод кросплатформений і правильно працюватиме незалежно від того, який
бекенд shelve використовує під капотом.
</p>
</div>
</div>
<div id="outline-container-org3e3557f" class="outline-2">
<h2 id="org3e3557f"><span class="section-number-2">3.</span> 6.2 Продовження</h2>
<div class="outline-text-2" id="text-3">
<p>
Щоб перевірити результат, напишемо ще один сценарій. Нижче наведено лістинг
інтерактивного сеансу, який виконує роль клієнта БД (файл <code>travaille.py</code>):
</p>
<div class="org-src-container">
<pre class="src src-python">&gt;&gt;&gt; <span style="color: #a0522d;">db</span>=shelve.<span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #707183;">(</span><span style="color: #8b7500;">'persondb'</span>, <span style="color: #8b7500;">'r'</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1074;&#1110;&#1076;&#1082;&#1088;&#1080;&#1090;&#1080; &#1089;&#1093;&#1086;&#1074;&#1080;&#1097;&#1077; </span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span><span style="color: #8b0000; font-weight: bold;">len</span><span style="color: #7388d6;">(</span>db<span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1091; &#1089;&#1093;&#1086;&#1074;&#1080;&#1097;&#1110; &#1084;&#1072;&#1108;&#1084;&#1086; &#1090;&#1088;&#1080; &#8215;&#1079;&#1072;&#1087;&#1080;&#1089;&#1080;&#8216;</span>
<span style="color: #008b8b;">3</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span><span style="color: #8b0000; font-weight: bold;">list</span><span style="color: #7388d6;">(</span>db.keys<span style="color: #909183;">()</span><span style="color: #7388d6;">)</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">keys &#8211; &#1094;&#1077; &#1079;&#1072;&#1075;&#1086;&#1083;&#1086;&#1074;&#1086;&#1082; </span>
<span style="color: #707183;">[</span><span style="color: #8b7500;">'Bob Smith'</span>, <span style="color: #8b7500;">'Sue Jones'</span>, <span style="color: #8b7500;">'Tom Jones'</span><span style="color: #707183;">]</span>
&gt;&gt;&gt; <span style="color: #a0522d;">bob</span>=db<span style="color: #707183;">[</span><span style="color: #8b7500;">'Bob Smith'</span><span style="color: #707183;">]</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1074;&#1080;&#1090;&#1103;&#1075;&#1090;&#1080; &#1086;&#1073;&#8216;&#1108;&#1082;&#1090; bob &#1079;&#1072; &#1082;&#1083;&#1102;&#1095;&#1077;&#1084; </span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span>bob<span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1074;&#1080;&#1082;&#1083;&#1080;&#1095;&#1077; &#1084;&#1077;&#1090;&#1086;&#1076; __str__ </span>
Bob Smith, <span style="color: #008b8b;">None</span>, <span style="color: #008b8b;">0</span>.<span style="color: #008b8b;">0</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span>bob.lastName<span style="color: #7388d6;">()</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1042;&#1080;&#1082;&#1083;&#1080;&#1095;&#1077; lastName &#1079; &#1082;&#1083;&#1072;&#1089;&#1091; Person</span>
Smith
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">for</span> key <span style="color: #8b0000; font-weight: bold;">in</span> db: <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1030;&#1090;&#1077;&#1088;&#1072;&#1094;&#1110;&#1111;, &#1074;&#1080;&#1090;&#1103;&#1075;&#1072;&#1085;&#1085;&#1103;, &#1074;&#1080;&#1074;&#1077;&#1076;&#1077;&#1085;&#1085;&#1103; </span>
...     <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span>key, <span style="color: #8b7500;">'=&gt;'</span>, db<span style="color: #7388d6;">[</span>key<span style="color: #7388d6;">]</span><span style="color: #707183;">)</span> 
... 
Bob <span style="color: #a0522d;">Smith</span> =&gt; Bob Smith, <span style="color: #008b8b;">None</span>, <span style="color: #008b8b;">0</span>.<span style="color: #008b8b;">0</span>
Sue <span style="color: #a0522d;">Jones</span> =&gt; Sue Jones, dev, <span style="color: #008b8b;">100000</span>.<span style="color: #008b8b;">0</span>
Tom <span style="color: #a0522d;">Jones</span> =&gt; Tom Jones, mgr, <span style="color: #008b8b;">50000</span>.<span style="color: #008b8b;">0</span>
&gt;&gt;&gt; <span style="color: #8b0000; font-weight: bold;">for</span> key <span style="color: #8b0000; font-weight: bold;">in</span> <span style="color: #8b0000; font-weight: bold;">sorted</span><span style="color: #707183;">(</span>db<span style="color: #707183;">)</span>:
...     <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span>key,<span style="color: #8b7500;">'=&gt;'</span>,db<span style="color: #7388d6;">[</span>key<span style="color: #7388d6;">]</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;">#</span><span style="color: #27408b; font-style: italic;">&#1030;&#1090;&#1077;&#1088;&#1072;&#1094;&#1110;&#1111; &#1095;&#1077;&#1088;&#1077;&#1079; &#1074;&#1110;&#1076;&#1089;&#1086;&#1088;&#1090;&#1086;&#1074;&#1072;&#1085;&#1080;&#1081; &#1089;&#1087;&#1080;&#1089;&#1086;&#1082; &#1082;&#1083;&#1102;&#1095;&#1110;&#1074;</span>
... 
Bob <span style="color: #a0522d;">Smith</span> =&gt; Bob Smith, <span style="color: #008b8b;">None</span>, <span style="color: #008b8b;">0</span>.<span style="color: #008b8b;">0</span>
Sue <span style="color: #a0522d;">Jones</span> =&gt; Sue Jones, dev, <span style="color: #008b8b;">100000</span>.<span style="color: #008b8b;">0</span>
Tom <span style="color: #a0522d;">Jones</span> =&gt; Tom Jones, mgr, <span style="color: #008b8b;">50000</span>.<span style="color: #008b8b;">0</span>
&gt;&gt;&gt; 

</pre>
</div>

<p>
Коли модуль pickle перетворює екземпляр класу, він записує атрибути екземпляру
self разом з ім'ям класу, з якого він був створений, та ім'ям модуля, де
знаходиться визначення цього класу. Коли пізніше об'єкт bob витягують зі
сховища, інтерпретатор імпортує клас і пов'язує з ним об'єкт bob. Завдяки цьому
після завантаження екземпляри класів автоматично знаходять поведінку свого
класу. Необхідно імпортувати класи, тільки якщо треба створювати нові
екземпляри, але не для роботи з існуючими.
</p>
</div>
</div>
<div id="outline-container-org2911998" class="outline-2">
<h2 id="org2911998"><span class="section-number-2">4.</span> 6.3 Оновлення об'єктів в сховищі</h2>
<div class="outline-text-2" id="text-4">
<p>
Створимо останній сценарій, який оновлює екземпляри (записи) при кожному
запуску, щоб переконатися, що об'єкти дійсно зберігаються (тобто при кожному
запуску програми доступні їх поточні значення). Файл <code>updatedb.py</code> виводить вміст
БД і збільшує зарплату одному з об'єктів при кожному запуску. Цей сценарій має
масу можливостей – при виведенні об'єктів автоматично викликають реалізацію
методу <code>__str__</code> і підвищення зарплати виконують викликом методу <code>giveRaise</code>:
</p>
<div class="org-src-container">
<pre class="src src-python"><span style="color: #8b0000; font-weight: bold;">import</span> shelve
<span style="color: #a0522d;">db</span> = shelve.<span style="color: #8b0000; font-weight: bold;">open</span><span style="color: #707183;">(</span><span style="color: #8b7500;">"persondb"</span><span style="color: #707183;">)</span>
<span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1074;&#1110;&#1076;&#1082;&#1088;&#1080;&#1090;&#1080; &#1091; &#1089;&#1093;&#1086;&#1074;&#1080;&#1097;&#1110; &#1092;&#1072;&#1081;&#1083; &#1079; &#1074;&#1082;&#1072;&#1079;&#1072;&#1085;&#1080;&#1084; &#1110;&#1084;&#8216;&#1103;&#1084;</span>
<span style="color: #8b0000; font-weight: bold;">for</span> key <span style="color: #8b0000; font-weight: bold;">in</span> <span style="color: #8b0000; font-weight: bold;">sorted</span><span style="color: #707183;">(</span>db<span style="color: #707183;">)</span>: <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1074;&#1110;&#1076;&#1086;&#1073;&#1088;&#1072;&#1079;&#1080;&#1090;&#1080; &#1086;&#1073;&#8216;&#1108;&#1082;&#1090;&#1080; &#1079; &#1041;&#1044;</span>
    <span style="color: #8b0000; font-weight: bold;">print</span><span style="color: #707183;">(</span>key, <span style="color: #8b7500;">"</span><span style="color: #008b8b;">\t</span><span style="color: #8b7500;">=&gt;"</span>, db<span style="color: #7388d6;">[</span>key<span style="color: #7388d6;">]</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1042;&#1080;&#1074;&#1077;&#1076;&#1077;&#1085;&#1085;&#1103; &#1074; &#1085;&#1077;&#1086;&#1073;&#1093;&#1110;&#1076;&#1085;&#1086;&#1084;&#1091; &#1092;&#1086;&#1088;&#1084;&#1072;&#1090;&#1110;</span>

<span style="color: #a0522d;">sue</span>=db<span style="color: #707183;">[</span><span style="color: #8b7500;">"Sue Jones"</span><span style="color: #707183;">]</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1074;&#1080;&#1090;&#1103;&#1075;&#1090;&#1080; &#1086;&#1073;&#8216;&#1108;&#1082;&#1090;&#1080; &#1079;&#1072; &#1082;&#1083;&#1102;&#1095;&#1077;&#1084;</span>
sue.giveRaise<span style="color: #707183;">(</span>.<span style="color: #008b8b;">10</span><span style="color: #707183;">)</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1079;&#1084;&#1110;&#1085;&#1080;&#1090;&#1080; &#1086;&#1073;&#8216;&#1108;&#1082;&#1090; &#1091; &#1087;&#1072;&#1084;&#8216;&#1103;&#1090;&#1110; &#1096;&#1083;&#1103;&#1093;&#1086;&#1084; &#1074;&#1080;&#1082;&#1083;&#1080;&#1082;&#1091; &#1084;&#1077;&#1090;&#1086;&#1076;&#1072;</span>
<span style="color: #a0522d;">db</span><span style="color: #707183;">[</span><span style="color: #8b7500;">"Sue Jones"</span><span style="color: #707183;">]</span>=sue <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1087;&#1088;&#1080;&#1089;&#1074;&#1086;&#1111;&#1090;&#1080; &#1079;&#1072; &#1082;&#1083;&#1102;&#1095;&#1077;&#1084;,</span>
<span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1097;&#1086;&#1073; &#1086;&#1085;&#1086;&#1074;&#1080;&#1090;&#1080; &#1086;&#1073;&#8216;&#1108;&#1082;&#1090; &#1091; &#1089;&#1093;&#1086;&#1074;&#1080;&#1097;&#1110;</span>
db.close<span style="color: #707183;">()</span> <span style="color: #27408b; font-style: italic;"># </span><span style="color: #27408b; font-style: italic;">&#1079;&#1072;&#1082;&#1088;&#1080;&#1090;&#1080; &#1092;&#1072;&#1081;&#1083; &#1087;&#1110;&#1089;&#1083;&#1103; &#1074;&#1085;&#1077;&#1089;&#1077;&#1085;&#1085;&#1103; &#1079;&#1084;&#1110;&#1085;</span>
</pre>
</div>


<pre class="example">
Bob Smith 	=&gt; Bob Smith, None, 0.0
Sue Jones 	=&gt; Sue Jones, dev, 100000.0
Tom Jones 	=&gt; Tom Jones, mgr, 50000.0
</pre>


<pre class="example">
Bob Smith 	=&gt; Bob Smith, None, 0.0
Sue Jones 	=&gt; Sue Jones, dev, 110000
Tom Jones 	=&gt; Tom Jones, mgr, 50000.0
</pre>


<pre class="example">
Bob Smith 	=&gt; Bob Smith, None, 0.0
Sue Jones 	=&gt; Sue Jones, dev, 121000
Tom Jones 	=&gt; Tom Jones, mgr, 50000.0
</pre>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="date">Date: 2025-03-09 Sun 00:00</p>
<p class="author">Author: Авраменко Ігор Андрійович 201-Б</p>
<p class="date">Created: 2025-03-16 Sun 23:57</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
